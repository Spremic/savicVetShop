<!DOCTYPE html>
<html lang="en" id="html">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= product ? product.title + ' - Happy Animals' : 'Product - Happy Animals' %></title>
    
    <!-- Resource Hints -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <link rel="dns-prefetch" href="https://code.jquery.com" />
    
    <!-- Critical CSS -->
    <link rel="preload" href="/css/clone.css" as="style" />
    <link rel="preload" href="/css/index.css" as="style" />
    <link rel="preload" href="/css/product.css" as="style" />
    <link rel="stylesheet" href="/css/clone.css" />
    <link rel="stylesheet" href="/css/index.css" />
    <link rel="stylesheet" href="/css/product.css" />
    <link rel="stylesheet" href="/css/loader.css" />
    
    <!-- External CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" defer></script>
  </head>
  <body id="body">
    <!-- Page Loader -->
    <div id="page-loader">
      <div class="loader-content">
        <div class="loader-logo">
          <svg class="loader-paw" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
            <path d="M226.5 92.9c14.3 42.9-.3 86.2-32.6 96.8s-70.1-15.6-84.4-58.5s.3-86.2 32.6-96.8s70.1 15.6 84.4 58.5zM100.4 198.6c18.9 32.4 14.3 70.1-10.2 84.1s-59.7-.9-78.5-33.3S-2.7 179.3 21.8 165.3s59.7 .9 78.5 33.3zM69.2 401.2C121.6 259.9 214.7 224 256 224s134.4 35.9 186.8 177.2c3.6 9.7 5.2 20.1 5.2 30.5v1.6c0 25.8-20.9 46.7-46.7 46.7c-11.5 0-22.9-1.4-34-4.2l-88-22c-15.3-3.8-31.3-3.8-46.6 0l-88 22c-11.1 2.8-22.5 4.2-34 4.2C84.9 480 64 459.1 64 433.3v-1.6c0-10.4 1.6-20.8 5.2-30.5zM421.8 282.7c-24.5-14-29.1-51.7-10.2-84.1s54-47.3 78.5-33.3s29.1 51.7 10.2 84.1s-54 47.3-78.5 33.3zM310.1 189.7c-32.3-10.6-46.9-53.9-32.6-96.8s52.1-69.1 84.4-58.5s46.9 53.9 32.6 96.8s-52.1 69.1-84.4 58.5z"/>
          </svg>
        </div>
        <div class="loader-text">Happy Animals</div>
        <div class="loader-progress">
          <div class="loader-progress-bar"></div>
        </div>
      </div>
    </div>

    <!-- Header ce biti dinamicki ucitan iz clone.js -->

    <main class="product-page">
      <div class="product-container">
        <!-- Left Column: Product Images -->
        <div class="product-images reveal-left">
          <div class="images-wrapper">
            <div class="thumbnail-container">
              <% 
                const fallbackImages = [
                  "/img/granula.jpg",
                  "/img/pas1.jpg",
                  "/img/pas2.jpg",
                  "/img/pas3.jpg",
                  "/img/pansion.jpg",
                  "/img/pansionSlika.jpg",
                  "/img/zec.jpg",
                  "/img/papagaj.png",
                  "/img/pasPozadina.jpg",
                  "/img/pozadinaMacka.jpg",
                  "/img/galerija/lokal1.jpg",
                  "/img/galerija/lokal2.jpg",
                  "/img/galerija/lokal3.jpg",
                  "/img/galerija/lokal4.jpg",
                  "/img/galerija/lokal5.jpg",
                  "/img/galerija/lokal6.jpg"
                ];
                const productImage = product && product.image ? product.image : fallbackImages[0];
                const imagesToShow = product && product.image ? [product.image, ...fallbackImages.slice(0, 8)] : fallbackImages.slice(0, 9);
              %>
              <% imagesToShow.forEach((imgSrc, index) => { %>
                <div class="thumbnail <%= index === 0 ? 'active' : '' %>" data-image="<%= imgSrc %>">
                  <img src="<%= imgSrc %>" alt="Thumbnail <%= index + 1 %>" loading="lazy" />
                </div>
              <% }); %>
            </div>
            
            <div class="main-image-container">
              <img id="mainProductImage" src="<%= productImage %>" alt="<%= product ? product.title : 'Product Image' %>" class="main-image" loading="eager" fetchpriority="high" />
              <button class="image-zoom-btn" aria-label="Zoom image">
                <span class="material-symbols-outlined">zoom_in</span>
              </button>
              <button class="image-arrow-left" aria-label="Previous image">
                <span class="material-symbols-outlined">arrow_back_ios</span>
              </button>
              <button class="image-arrow-right" aria-label="Next image">
                <span class="material-symbols-outlined">arrow_forward_ios</span>
              </button>
            </div>
          </div>

          <!-- Seller Information Card -->
          <div class="seller-card reveal-left delay-200">
            <div class="seller-info">
              <div class="seller-logo">
                <img src="/img/happy animal.png" alt="Happy Animals" loading="lazy" />
                <span class="verified-badge">
                  <span class="material-symbols-outlined">verified</span>
                </span>
              </div>
              <div class="seller-details">
                <h4>Happy Animals</h4>
                <div class="seller-rating">
                  <span class="satisfied-customers">1000+ Satisfied Customers</span>
                </div>
                <div class="seller-location">
                  <span class="material-symbols-outlined">location_on</span>
                  <span>New York, USA</span>
                </div>
              </div>
            </div>
            <button class="view-more-btn">View More</button>
          </div>
        </div>

        <!-- Right Column: Product Details -->
        <div class="product-details reveal-right">
          <% if (product) { %>
            <% if (product.percentage && product.percentage !== '/') { %>
              <div class="product-badge reveal delay-100">-<%= product.percentage %></div>
            <% } else { %>
              <div class="product-badge reveal delay-100">NEW ARRIVAL</div>
            <% } %>
            
            <h1 class="product-title reveal delay-100"><%= product.title %></h1>
            
            <div class="product-price reveal delay-200">
              <% if (product.salePrice && product.salePrice !== '/') { %>
                <span class="currency">RSD</span>
                <span class="amount"><%= product.salePrice %></span>
                <span class="old-price"><%= product.price %> RSD</span>
              <% } else { %>
                <span class="currency">RSD</span>
                <span class="amount"><%= product.price %></span>
              <% } %>
            </div>

            <!-- Description -->
            <div class="product-description reveal delay-300">
              <h3 class="description-title">Description:</h3>
              <p class="description-text">
                <%= product.description %>
              </p>
            </div>
          <% } else { %>
            <div class="product-badge reveal delay-100">NEW ARRIVAL</div>
            <h1 class="product-title reveal delay-100">Product Not Found</h1>
            <div class="product-price reveal delay-200">
              <span class="currency">RSD</span>
              <span class="amount">0</span>
            </div>
            <div class="product-description reveal delay-300">
              <h3 class="description-title">Description:</h3>
              <p class="description-text">The requested product could not be found.</p>
            </div>
          <% } %>

          <!-- Action Buttons -->
          <div class="product-actions reveal delay-400">
            <button class="btn-buy-now">
              <span class="material-symbols-outlined">shopping_cart</span>
              Buy Now
            </button>
            <button class="btn-add-cart">
              <span class="material-symbols-outlined">add_shopping_cart</span>
              Add to Cart
            </button>
            <button class="btn-favorite" aria-label="Add to favorites">
              <span class="material-symbols-outlined">favorite</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Specifications Section -->
      <section class="specifications-section">
        <h2 class="specifications-title reveal">Specifications</h2>
        <div class="specifications-content">
          <% if (product) { %>
            <% if (product.brand) { %>
              <div class="spec-item reveal delay-100">
                <div class="spec-label-wrapper">
                  <span class="spec-label">Brand:</span>
                </div>
                <div class="spec-value-wrapper">
                  <span class="spec-value"><%= product.brand %></span>
                </div>
              </div>
            <% } %>
            <% if (product.technicalData && product.technicalData.labels) { %>
              <% product.technicalData.labels.forEach((label, index) => { %>
                <div class="spec-item reveal delay-<%= Math.floor(index / 3) + 1 %>00">
                  <div class="spec-label-wrapper">
                    <span class="spec-label"><%= label %></span>
                  </div>
                  <div class="spec-value-wrapper">
                    <span class="spec-value"><%= product.technicalData.features[index] || 'N/A' %></span>
                  </div>
                </div>
              <% }); %>
            <% } else { %>
              <% if (product.category) { %>
                <div class="spec-item reveal delay-100">
                  <div class="spec-label-wrapper">
                    <span class="spec-label">Category:</span>
                  </div>
                  <div class="spec-value-wrapper">
                    <span class="spec-value"><%= product.category %></span>
                  </div>
                </div>
              <% } %>
              <% if (product.subcategory) { %>
                <div class="spec-item reveal delay-200">
                  <div class="spec-label-wrapper">
                    <span class="spec-label">Subcategory:</span>
                  </div>
                  <div class="spec-value-wrapper">
                    <span class="spec-value"><%= product.subcategory %></span>
                  </div>
                </div>
              <% } %>
              <% if (product.type) { %>
                <div class="spec-item reveal delay-200">
                  <div class="spec-label-wrapper">
                    <span class="spec-label">Type:</span>
                  </div>
                  <div class="spec-value-wrapper">
                    <span class="spec-value"><%= product.type %></span>
                  </div>
                </div>
              <% } %>
            <% } %>
          <% } else { %>
            <div class="spec-item reveal delay-100">
              <div class="spec-label-wrapper">
                <span class="spec-label">Status:</span>
              </div>
              <div class="spec-value-wrapper">
                <span class="spec-value">Product not found</span>
              </div>
            </div>
          <% } %>
        </div>
      </section>

      <!-- Recommended Products Section -->
      <section class="recommended-section">
        <h3 class="recommended-title reveal">Recommended Products</h3>
        
        <div class="recommended-flex-container">
          <div class="recommended-arrow-l">
            <span class="material-symbols-outlined">arrow_back_ios_new</span>
          </div>

          <div class="recommended-mid-wrapper">
            <div class="recommended-mid" id="recommendedProducts">
              <!-- Recommended products will be dynamically loaded here -->
            </div>
          </div>

          <div class="recommended-arrow-r">
            <span class="material-symbols-outlined">arrow_forward_ios</span>
          </div>
        </div>
      </section>

    </main>

    <!-- Footer ce biti dinamicki ucitan iz clone.js -->

    <script src="/js/clone.js" defer></script>
    <script src="/js/index.js" defer></script>
    <script src="/js/product.js" defer></script>
    <script src="/js/loader.js" defer></script>
  </body>
</html>
